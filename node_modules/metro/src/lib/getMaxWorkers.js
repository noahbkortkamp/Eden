/**
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 *
 * @format
 * 
 * // Patched for Node.js 16 compatibility
 */

"use strict";

const os = require("os");

// Polyfill for Node.js < 18
if (!os.availableParallelism) {
  os.availableParallelism = function() {
    // Just return the CPU count as a fallback
    return os.cpus().length;
  };
  console.log('âœ… Added polyfill for os.availableParallelism');
}

module.exports = function getMaxWorkers(overrideMaxWorkers) {
  const cpus = os.availableParallelism();
  return typeof overrideMaxWorkers === "number"
    ? Math.min(overrideMaxWorkers, cpus)
    : // Require at least one worker.
      Math.max(1, Math.ceil(cpus / 2));
};
